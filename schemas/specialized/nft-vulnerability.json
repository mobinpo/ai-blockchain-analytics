{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://ai-blockchain-analytics.com/schemas/nft-vulnerability.json",
  "title": "NFT-Specific Vulnerability Finding",
  "description": "Extended schema for NFT marketplace and collection vulnerability findings",
  "allOf": [
    {
      "$ref": "../vulnerability-finding-schema.json"
    }
  ],
  "properties": {
    "nft_context": {
      "type": "object",
      "description": "NFT-specific context and metadata",
      "properties": {
        "nft_type": {
          "type": "string",
          "enum": [
            "ERC721",
            "ERC1155",
            "MARKETPLACE",
            "AUCTION",
            "ROYALTY_SYSTEM",
            "FRACTIONAL_NFT",
            "DYNAMIC_NFT",
            "SOULBOUND_TOKEN",
            "UTILITY_NFT"
          ]
        },
        "marketplace_features": {
          "type": "object",
          "properties": {
            "fixed_price_sales": {
              "type": "boolean"
            },
            "auction_system": {
              "type": "boolean"
            },
            "offer_system": {
              "type": "boolean"
            },
            "royalty_enforcement": {
              "type": "boolean"
            },
            "batch_operations": {
              "type": "boolean"
            },
            "lazy_minting": {
              "type": "boolean"
            }
          }
        },
        "metadata_risks": {
          "type": "object",
          "properties": {
            "centralized_storage": {
              "type": "boolean",
              "description": "Whether metadata is stored centrally"
            },
            "mutable_metadata": {
              "type": "boolean",
              "description": "Whether metadata can be changed after minting"
            },
            "ipfs_usage": {
              "type": "boolean"
            },
            "metadata_validation": {
              "type": "boolean",
              "description": "Whether metadata is validated on-chain"
            }
          }
        },
        "royalty_system": {
          "type": "object",
          "properties": {
            "royalty_standard": {
              "type": "string",
              "enum": ["EIP2981", "CUSTOM", "NONE"]
            },
            "bypass_possible": {
              "type": "boolean"
            },
            "percentage_validation": {
              "type": "boolean"
            },
            "creator_verification": {
              "type": "boolean"
            }
          }
        },
        "ownership_risks": {
          "type": "object",
          "properties": {
            "ownership_transfer": {
              "type": "boolean",
              "description": "Issues with ownership transfer mechanisms"
            },
            "approval_risks": {
              "type": "boolean",
              "description": "Risks in approval mechanisms"
            },
            "enumeration_issues": {
              "type": "boolean"
            },
            "batch_transfer_risks": {
              "type": "boolean"
            }
          }
        },
        "marketplace_risks": {
          "type": "object",
          "properties": {
            "fake_collection": {
              "type": "boolean",
              "description": "Risk of fake collection creation"
            },
            "price_manipulation": {
              "type": "boolean"
            },
            "wash_trading": {
              "type": "boolean"
            },
            "front_running": {
              "type": "boolean"
            },
            "seller_verification": {
              "type": "boolean"
            }
          }
        }
      },
      "required": ["nft_type"],
      "additionalProperties": false
    },
    "collection_impact": {
      "type": "object",
      "description": "Impact on NFT collections and holders",
      "properties": {
        "affected_tokens": {
          "type": "object",
          "properties": {
            "total_supply": {
              "type": "integer",
              "minimum": 0
            },
            "affected_count": {
              "type": "integer",
              "minimum": 0
            },
            "floor_price_impact": {
              "type": "number",
              "description": "Expected floor price impact percentage"
            }
          }
        },
        "holder_impact": {
          "type": "object",
          "properties": {
            "unique_holders": {
              "type": "integer",
              "minimum": 0
            },
            "affected_holders": {
              "type": "integer",
              "minimum": 0
            },
            "avg_loss_per_holder": {
              "type": "number",
              "description": "Average loss per holder in USD"
            }
          }
        },
        "market_impact": {
          "type": "object",
          "properties": {
            "trading_volume_impact": {
              "type": "number",
              "description": "Impact on trading volume percentage"
            },
            "marketplace_reputation": {
              "type": "string",
              "enum": ["CRITICAL", "HIGH", "MEDIUM", "LOW", "NONE"]
            },
            "ecosystem_confidence": {
              "type": "string",
              "enum": ["SEVERELY_DAMAGED", "DAMAGED", "SLIGHTLY_AFFECTED", "UNAFFECTED"]
            }
          }
        }
      },
      "additionalProperties": false
    },
    "attack_scenarios": {
      "type": "object",
      "description": "NFT-specific attack scenarios",
      "properties": {
        "rug_pull": {
          "type": "object",
          "properties": {
            "metadata_rug": {
              "type": "boolean"
            },
            "royalty_rug": {
              "type": "boolean"
            },
            "utility_rug": {
              "type": "boolean"
            }
          }
        },
        "marketplace_exploit": {
          "type": "object",
          "properties": {
            "listing_manipulation": {
              "type": "boolean"
            },
            "bid_manipulation": {
              "type": "boolean"
            },
            "fee_bypass": {
              "type": "boolean"
            }
          }
        },
        "minting_exploit": {
          "type": "object",
          "properties": {
            "free_mint": {
              "type": "boolean"
            },
            "over_mint": {
              "type": "boolean"
            },
            "presale_bypass": {
              "type": "boolean"
            }
          }
        }
      },
      "additionalProperties": false
    }
  },
  "examples": [
    {
      "id": "NFT_MARKETPLACE_001",
      "severity": "HIGH",
      "title": "Price Manipulation in NFT Auction System",
      "category": "PRICE_MANIPULATION",
      "subcategory": "Auction Manipulation",
      "description": "The auction contract allows bidders to place bids and immediately withdraw them in the same transaction, enabling price manipulation and fake bidding activity that inflates perceived value.",
      "nft_context": {
        "nft_type": "MARKETPLACE",
        "marketplace_features": {
          "fixed_price_sales": true,
          "auction_system": true,
          "offer_system": false,
          "royalty_enforcement": true,
          "batch_operations": false,
          "lazy_minting": false
        },
        "marketplace_risks": {
          "fake_collection": false,
          "price_manipulation": true,
          "wash_trading": true,
          "front_running": false,
          "seller_verification": false
        }
      },
      "collection_impact": {
        "affected_tokens": {
          "total_supply": 10000,
          "affected_count": 500,
          "floor_price_impact": 15.0
        },
        "holder_impact": {
          "unique_holders": 3000,
          "affected_holders": 150,
          "avg_loss_per_holder": 2500
        },
        "market_impact": {
          "trading_volume_impact": -30.0,
          "marketplace_reputation": "HIGH",
          "ecosystem_confidence": "DAMAGED"
        }
      },
      "attack_scenarios": {
        "marketplace_exploit": {
          "listing_manipulation": false,
          "bid_manipulation": true,
          "fee_bypass": false
        }
      },
      "recommendation": {
        "summary": "Implement bid commitment period and prevent immediate bid withdrawals to stop auction manipulation",
        "details": "1. Add minimum bid commitment period (e.g., 1 hour)\n2. Implement bid withdrawal delays to prevent same-transaction manipulation\n3. Add bid increment validation\n4. Consider implementing sealed-bid auctions for high-value items\n5. Add suspicious activity monitoring and alerts",
        "references": [
          {
            "title": "NFT Marketplace Security Best Practices",
            "url": "https://consensys.net/blog/developers/nft-marketplace-security-best-practices/",
            "type": "best_practice"
          }
        ]
      },
      "location": {
        "file": "AuctionSystem.sol",
        "line": 203,
        "function": "placeBid",
        "contract": "NFTAuction"
      },
      "confidence": {
        "level": "HIGH",
        "score": 0.89
      },
      "timestamp": "2024-01-15T14:42:00Z",
      "scanner": {
        "name": "AI Blockchain Analytics",
        "version": "2.1.0",
        "scan_id": "scan_nft_001"
      }
    }
  ]
}