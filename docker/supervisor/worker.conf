[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# Laravel Horizon Workers
[program:horizon]
process_name=%(program_name)s_%(process_num)02d
command=php /app/artisan horizon
directory=/app
autostart=true
autorestart=true
user=appuser
numprocs=1
redirect_stderr=true
stdout_logfile=/app/storage/logs/horizon.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
stderr_logfile=/app/storage/logs/horizon-error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=5
stopwaitsecs=60
stopasgroup=true
killasgroup=true
priority=999

# Queue Workers (backup/additional)
[program:queue-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /app/artisan queue:work redis --sleep=3 --tries=3 --max-time=3600 --memory=512
directory=/app
autostart=true
autorestart=true
user=appuser
numprocs=2
redirect_stderr=true
stdout_logfile=/app/storage/logs/queue-worker.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=3
stderr_logfile=/app/storage/logs/queue-worker-error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=3
stopwaitsecs=60
stopasgroup=true
killasgroup=true
priority=998

# High Priority Queue Workers
[program:high-priority-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /app/artisan queue:work redis --queue=high,default --sleep=1 --tries=3 --max-time=1800 --memory=256
directory=/app
autostart=true
autorestart=true
user=appuser
numprocs=1
redirect_stderr=true
stdout_logfile=/app/storage/logs/high-priority-worker.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=3
stderr_logfile=/app/storage/logs/high-priority-worker-error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=3
stopwaitsecs=30
stopasgroup=true
killasgroup=true
priority=997

# Blockchain Analysis Workers
[program:blockchain-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /app/artisan queue:work redis --queue=blockchain,analysis,default --sleep=5 --tries=2 --max-time=7200 --memory=1024
directory=/app
autostart=true
autorestart=true
user=appuser
numprocs=1
redirect_stderr=true
stdout_logfile=/app/storage/logs/blockchain-worker.log
stdout_logfile_maxbytes=100MB
stdout_logfile_backups=3
stderr_logfile=/app/storage/logs/blockchain-worker-error.log
stderr_logfile_maxbytes=100MB
stderr_logfile_backups=3
stopwaitsecs=120
stopasgroup=true
killasgroup=true
priority=996

# Sentiment Analysis Workers
[program:sentiment-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /app/artisan queue:work redis --queue=sentiment,nlp,default --sleep=3 --tries=3 --max-time=3600 --memory=512
directory=/app
autostart=true
autorestart=true
user=appuser
numprocs=1
redirect_stderr=true
stdout_logfile=/app/storage/logs/sentiment-worker.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=3
stderr_logfile=/app/storage/logs/sentiment-worker-error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=3
stopwaitsecs=60
stopasgroup=true
killasgroup=true
priority=995
