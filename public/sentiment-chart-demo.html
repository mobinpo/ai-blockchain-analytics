<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentiment vs Price Chart Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .chart-container {
            position: relative;
            height: 500px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">ðŸ“ˆ Sentiment vs Price Timeline Demo</h1>
            <p class="text-gray-600 mb-4">
                Interactive chart showing correlation between cryptocurrency sentiment analysis and price movements.
                This demo uses mock data to demonstrate the functionality of our Vue.js chart component.
            </p>
            
            <!-- Controls -->
            <div class="flex gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Cryptocurrency:</label>
                    <select id="coinSelect" class="px-3 py-2 border border-gray-300 rounded-md bg-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="bitcoin">Bitcoin</option>
                        <option value="ethereum">Ethereum</option>
                        <option value="cardano">Cardano</option>
                        <option value="solana">Solana</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Time Range:</label>
                    <select id="timeRange" class="px-3 py-2 border border-gray-300 rounded-md bg-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="7">7 Days</option>
                        <option value="30">30 Days</option>
                        <option value="90">90 Days</option>
                    </select>
                </div>
                
                <div class="flex items-end">
                    <button id="refreshBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        Refresh Data
                    </button>
                </div>
            </div>
        </div>

        <!-- Chart -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">Sentiment vs Price Correlation</h2>
            <div class="chart-container">
                <canvas id="sentimentChart"></canvas>
            </div>
        </div>

        <!-- Legend -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h3 class="text-lg font-semibold mb-4">Chart Legend</h3>
            <div class="flex justify-center gap-8">
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-blue-500 rounded"></div>
                    <span>Sentiment Score (-1 to 1)</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-green-500 rounded"></div>
                    <span>Price (USD)</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-purple-500 rounded" style="background: linear-gradient(45deg, #a855f7 50%, transparent 50%);"></div>
                    <span>Correlation (Normalized)</span>
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-semibold mb-4">Statistical Analysis</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="statistics">
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                    <div class="text-2xl font-bold text-gray-800" id="correlationValue">0.000</div>
                    <div class="text-sm text-gray-600">Correlation Coefficient</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                    <div class="text-2xl font-bold text-gray-800" id="avgSentiment">0.000</div>
                    <div class="text-sm text-gray-600">Average Sentiment</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                    <div class="text-2xl font-bold text-gray-800" id="priceChange">0.00%</div>
                    <div class="text-sm text-gray-600">Price Change</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Chart instance
        let chart = null;
        
        // Generate mock sentiment data
        function generateMockSentimentData(days) {
            const data = [];
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - days);
            
            for (let i = 0; i < days; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                
                // Generate realistic sentiment with some volatility
                const basetrend = Math.sin(i / days * Math.PI * 2) * 0.3;
                const randomNoise = (Math.random() - 0.5) * 0.4;
                const sentiment = Math.max(-1, Math.min(1, basetrend + randomNoise));
                
                data.push({
                    date: date.toISOString().split('T')[0],
                    sentiment: sentiment,
                    posts: Math.floor(Math.random() * 100) + 20
                });
            }
            
            return data;
        }
        
        // Generate mock price data
        function generateMockPriceData(coin, days) {
            const basePrices = {
                bitcoin: 45000,
                ethereum: 3000,
                cardano: 0.50,
                solana: 100
            };
            
            const basePrice = basePrices[coin] || 1000;
            const data = [];
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - days);
            
            let currentPrice = basePrice;
            
            for (let i = 0; i < days; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                
                // Generate realistic price movement
                const change = (Math.random() - 0.5) * 0.1; // Â±5% daily change
                currentPrice *= (1 + change);
                currentPrice = Math.max(currentPrice, basePrice * 0.3); // Don't go below 30% of base
                
                data.push({
                    date: date.toISOString().split('T')[0],
                    price: currentPrice
                });
            }
            
            return data;
        }
        
        // Combine sentiment and price data
        function combineData(sentimentData, priceData) {
            const combined = [];
            const priceMap = new Map(priceData.map(item => [item.date, item.price]));
            
            sentimentData.forEach(sentiment => {
                const price = priceMap.get(sentiment.date);
                if (price !== undefined) {
                    combined.push({
                        date: sentiment.date,
                        sentiment: sentiment.sentiment,
                        price: price,
                        posts: sentiment.posts
                    });
                }
            });
            
            return combined.sort((a, b) => new Date(a.date) - new Date(b.date));
        }
        
        // Calculate correlation coefficient
        function calculateCorrelation(x, y) {
            const n = x.length;
            if (n === 0) return 0;
            
            const sumX = x.reduce((sum, val) => sum + val, 0);
            const sumY = y.reduce((sum, val) => sum + val, 0);
            const sumXY = x.reduce((sum, val, i) => sum + val * y[i], 0);
            const sumX2 = x.reduce((sum, val) => sum + val * val, 0);
            const sumY2 = y.reduce((sum, val) => sum + val * val, 0);
            
            const numerator = n * sumXY - sumX * sumY;
            const denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));
            
            return denominator === 0 ? 0 : numerator / denominator;
        }
        
        // Update statistics display
        function updateStatistics(data) {
            const sentiments = data.map(d => d.sentiment);
            const prices = data.map(d => d.price);
            
            // Calculate correlation
            const correlation = calculateCorrelation(sentiments, prices);
            
            // Calculate average sentiment
            const avgSentiment = sentiments.reduce((sum, s) => sum + s, 0) / sentiments.length;
            
            // Calculate price change
            const firstPrice = prices[0];
            const lastPrice = prices[prices.length - 1];
            const priceChange = ((lastPrice - firstPrice) / firstPrice) * 100;
            
            // Update DOM
            document.getElementById('correlationValue').textContent = correlation.toFixed(3);
            document.getElementById('avgSentiment').textContent = avgSentiment.toFixed(3);
            document.getElementById('priceChange').textContent = priceChange.toFixed(2) + '%';
            
            // Add color coding
            const corrElement = document.getElementById('correlationValue');
            corrElement.className = 'text-2xl font-bold ' + 
                (correlation > 0.3 ? 'text-green-600' : 
                 correlation < -0.3 ? 'text-red-600' : 'text-gray-800');
                 
            const sentElement = document.getElementById('avgSentiment');
            sentElement.className = 'text-2xl font-bold ' + 
                (avgSentiment > 0.2 ? 'text-green-600' : 
                 avgSentiment < -0.2 ? 'text-red-600' : 'text-gray-800');
                 
            const priceElement = document.getElementById('priceChange');
            priceElement.className = 'text-2xl font-bold ' + 
                (priceChange > 0 ? 'text-green-600' : 
                 priceChange < 0 ? 'text-red-600' : 'text-gray-800');
        }
        
        // Create or update chart
        function updateChart() {
            const coin = document.getElementById('coinSelect').value;
            const days = parseInt(document.getElementById('timeRange').value);
            
            // Generate mock data
            const sentimentData = generateMockSentimentData(days);
            const priceData = generateMockPriceData(coin, days);
            const combinedData = combineData(sentimentData, priceData);
            
            // Update statistics
            updateStatistics(combinedData);
            
            // Normalize price data for dual axis display
            const prices = combinedData.map(d => d.price);
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            const normalizedPrices = prices.map(price => 
                ((price - minPrice) / (maxPrice - minPrice)) * 2 - 1
            );
            
            const ctx = document.getElementById('sentimentChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Sentiment Score',
                            data: combinedData.map(d => ({ x: d.date, y: d.sentiment })),
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            yAxisID: 'y',
                            tension: 0.4,
                            pointRadius: 3,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'Price',
                            data: combinedData.map(d => ({ x: d.date, y: d.price })),
                            borderColor: 'rgb(16, 185, 129)',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            yAxisID: 'y1',
                            tension: 0.4,
                            pointRadius: 3,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'Correlation',
                            data: combinedData.map((d, i) => ({ x: d.date, y: normalizedPrices[i] })),
                            borderColor: 'rgba(168, 85, 247, 0.6)',
                            backgroundColor: 'rgba(168, 85, 247, 0.1)',
                            borderDash: [5, 5],
                            yAxisID: 'y',
                            tension: 0.4,
                            pointRadius: 2,
                            pointHoverRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: `${coin.charAt(0).toUpperCase() + coin.slice(1)} - Sentiment vs Price (${days} days)`
                        },
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label;
                                    const value = context.parsed.y;
                                    
                                    if (label === 'Sentiment Score') {
                                        return `${label}: ${value.toFixed(3)}`;
                                    } else if (label === 'Price') {
                                        return `${label}: $${value.toLocaleString()}`;
                                    } else if (label === 'Correlation') {
                                        return `${label}: ${value.toFixed(3)} (normalized)`;
                                    }
                                    return `${label}: ${value}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                displayFormats: {
                                    day: 'MMM dd',
                                    week: 'MMM dd',
                                    month: 'MMM yyyy'
                                }
                            },
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Sentiment Score'
                            },
                            min: -1,
                            max: 1
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Price (USD)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Initial chart creation
            updateChart();
            
            // Event listeners for controls
            document.getElementById('coinSelect').addEventListener('change', updateChart);
            document.getElementById('timeRange').addEventListener('change', updateChart);
            document.getElementById('refreshBtn').addEventListener('click', updateChart);
        });
    </script>
</body>
</html> 